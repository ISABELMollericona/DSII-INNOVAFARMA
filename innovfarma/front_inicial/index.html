<!doctype html>
<html lang="es">
<head>
  <base href="./">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>InnovFarma - Front Inicial</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Font Awesome para iconos del menú -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Tailwind compiled CSS -->
  <link rel="stylesheet" href="dist/tailwind.css">
  <!-- Custom theme overrides (flat, modern style) -->
  <link rel="stylesheet" href="custom_theme.css">
  <!-- Fallback CSS: asegura comportamiento del sidebar y separador visual si Tailwind no carga -->
  <style>
     /* Mantener la sidebar fija en escritorio (evita duplicar el margen y crear huecos)
       en pantallas pequeñas seguirá comportándose como off-canvas/hidden y se mostrará
       mediante la clase `hidden`/overlay. */
    /* En pantallas pequeñas forzamos fixed para overlay */
    @media (max-width: 1023px) {
      .sidebar { position: fixed; left: 0; top: 0; bottom: 0; z-index: 40; }
      .sidebar-overlay { display: none; }
    }
    /* Separador visual entre sidebar y contenido */
    .sidebar + #sidebarOverlay + main, .sidebar + main { border-left: 1px solid rgba(0,0,0,0.06); }
  </style>
  <!-- Forzar header verde por si Tailwind no carga o hay caché -->
  <style>
    header { background-color: #047857 !important; }
    header .brand { color: #ffffff !important; }
    header #btnMenuToggle, header .user-badge, header .btn { color: #ffffff !important; }
    header #btnMenuToggle:hover { background-color: rgba(255,255,255,0.06) !important; }
    header .user-badge { background: rgba(255,255,255,0.06) !important; padding: 6px 10px; border-radius: 9999px; }
    header .btn { background-color: #059669 !important; border-color: transparent !important; }
    header .btn.ghost { background: transparent !important; border: 1px solid rgba(255,255,255,0.12) !important; color: #ffffff !important; }
    /* Ensure header text is visible over green */
    header, header * { color: inherit; }
  </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900">
  <div class="app-wrapper">
    <header class="flex items-center justify-between p-4 bg-green-600 shadow-sm sticky top-0 z-20">
      <div class="flex items-center gap-4">
        <button id="btnMenuToggle" class="p-2 rounded-md hover:bg-white/10 text-white" aria-label="Abrir menú" aria-expanded="true"><i class="fa-solid fa-bars"></i></button>
        <div class="brand text-white">InnovFarma</div>
      </div>
      <div class="flex items-center gap-3">
        <div id="userName" class="user-badge">Invitado</div>
        <div class="flex items-center gap-2">
          <button id="btnLogin" class="btn small">Iniciar sesión</button>
          <button id="btnLogout" class="btn small" style="display:none">Salir</button>
        </div>
      </div>
    </header>
    <div class="layout flex">
      <aside class="sidebar lg:block fixed inset-y-0 left-0 w-64 z-40 overflow-auto" id="leftMenu">
        <div class="sidebar-header">
          <h3 class="text-lg font-semibold">Módulos</h3>
        </div>
        <nav>
          <ul>
            <li><a class="nav-link" href="#/inicio" data-route="/inicio" id="nav-inicio" data-roles="*"><i class="fa-solid fa-house-chimney icon"></i><span>Inicio</span></a></li>
            <li><a class="nav-link" href="#/productos" data-route="/productos" id="nav-productos" data-roles="admin"><i class="fa-solid fa-boxes-stacked icon"></i><span>Productos</span></a></li>
            <li><a class="nav-link" href="#/clientes" data-route="/clientes" id="nav-clientes" data-roles="admin,vendedor"><i class="fa-solid fa-user icon"></i><span>Clientes</span></a></li>
            <li><a class="nav-link" href="#/facturas" data-route="/facturas" id="nav-facturas" data-roles="admin,vendedor"><i class="fa-solid fa-file-invoice-dollar icon"></i><span>Facturas</span></a></li>
            <li>
              <a class="nav-link" href="#/inventarios" data-route="/inventarios" id="nav-inventarios" data-roles="admin"><i class="fa-solid fa-boxes-stacked fa-rotate-90 icon"></i><span>Inventarios</span></a>
              <ul class="submenu">
                <li><a class="nav-link" href="#/inventarios/overview" data-route="/inventarios/overview">Resumen / Kardex</a></li>
                <li><a class="nav-link" href="#/inventarios/lotes" data-route="/inventarios/lotes">Lotes / Caducidades</a></li>
                <!-- Traspasos eliminado: funcionalidad deshabilitada -->
                <li><a class="nav-link" href="#/inventarios/pedidos" data-route="/inventarios/pedidos">Pedidos</a></li>
                
              </ul>
            </li>
            <li><a class="nav-link" href="#/compras" data-route="/compras" id="nav-compras" data-roles="admin"><i class="fa-solid fa-truck-field icon"></i><span>Compras</span></a></li>
            <li><a class="nav-link" href="#/ventas" data-route="/ventas" id="nav-ventas" data-roles="vendedor"><i class="fa-solid fa-cash-register icon"></i><span>Ventas</span></a></li>
            <li><a class="nav-link" href="#/usuarios" data-route="/usuarios" id="nav-usuarios" data-roles="admin" data-manage-users="true"><i class="fa-solid fa-users-gear icon"></i><span>Usuarios</span></a></li>
          </ul>
        </nav>
      </aside>
  <div id="sidebarOverlay" class="sidebar-overlay fixed inset-0 bg-black/20 z-30 lg:hidden" tabindex="-1"></div>
      <main class="content flex-1 p-6" id="mainContent">
        <div id="pageContent" class="max-w-7xl mx-auto">
          <h2 class="text-3xl font-semibold mb-4">Bienvenido</h2>
          <div class="card">
            <p class="text-gray-600">Esta es la interfaz inicial servida desde Flask. Usa la API en <code>/api</code>.</p>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Modal root: aquí se montarán los modales dinámicos -->
  <div id="modalRoot" class="modal-root" aria-hidden="true"></div>

  <script>
    // Carga segura de app.js: elimina accidentalmente fences de Markdown si existen
    (async function(){
      try{
        const res = await fetch('app.js');
        let txt = await res.text();
        // eliminar fence inicial ```javascript y cierre ```, si existen
        txt = txt.replace(/^\s*```javascript\s*/, '');
        txt = txt.replace(/\s*```\s*$/, '');
        const s = document.createElement('script');
        s.type = 'text/javascript';
        s.text = txt;
        document.body.appendChild(s);
      }catch(e){ console.error('Error cargando app.js limpiado', e); }
    })();
  </script>
  <script>
    // Verifica si el CSS compilado está accesible en el servidor; si no, inyecta Tailwind CDN como fallback
    (async function(){
      try{
        const res = await fetch('dist/tailwind.css', { method: 'HEAD' });
        if(!res.ok){
          console.warn('CSS compilado no disponible, cargando Tailwind CDN como fallback');
          const s = document.createElement('script');
          s.src = 'https://cdn.tailwindcss.com';
          s.defer = true;
          document.head.appendChild(s);
          // pequeño fallback para componentes usados por la app
          const style = document.createElement('style');
          style.textContent = '.card{background:#fff;padding:1rem;border-radius:.5rem;box-shadow:0 6px 18px rgba(0,0,0,0.06);} .btn{background:#0f766e;color:#fff;padding:.35rem .75rem;border-radius:.375rem;} .sidebar{display:none}';
          document.head.appendChild(style);
        }
      }catch(e){
        console.warn('Error comprobando CSS compilado, cargando fallback', e);
        const s = document.createElement('script'); s.src='https://cdn.tailwindcss.com'; s.defer=true; document.head.appendChild(s);
      }
    })();
  </script>
  <!-- menu toggling behaviour handled by app.js to ensure consistent state and aria attributes -->
</body>
</html>